{"remainingRequest":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/Store.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/Store.vue","mtime":1547889925000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport qs from 'qs'\nexport default {\n  data () {\n    return {\n      merchantId: '',\n      merchantName: '',\n      headers: [\n        { text: '门店名称', value: 'name', sortable: false },\n        { text: '地址', value: 'area', sortable: false },\n        { text: '电话', value: 'logo', sortable: false },\n        { text: '操作', value: 'id', sortable: false }\n      ],\n      isPending: false,\n      desserts: [],\n      total: 0,\n      page: 1,\n      pageSize: 10,\n      selectItems: [{\n        value: 10,\n        text: '10条/页'\n      }, {\n        value: 20,\n        text: '20条/页'\n      }, {\n        value: 50,\n        text: '50条/页'\n      }],\n      isShowDialog: false, // 新增弹框\n      isReadOnly: false, // 详情\n      currentStoreId: '',\n      isUpdate: false, // 修改\n      valid: false,\n      storeInfo: {\n        name: '',\n        address: '',\n        telephone: ''\n      },\n      formRulse: {\n        nameRules: [\n          v => !!v || '门店名称不能为空'\n        ],\n        addressRules: [\n          v => !!v || '地址不能为空'\n        ]\n      }\n    }\n  },\n  created () {\n    let merchantId = this.$route.params.merchantId\n    this.merchantId = merchantId\n    this.merchantName = window.sessionStorage.getItem('merchantName')\n    this.fetchData(merchantId)\n  },\n  methods: {\n    fetchData (merchantId) {\n      this.isPending = true\n      this.$http({\n        url: '/travel/store/info',\n        method: 'GET',\n        params: {\n          userid: this.merchantId,\n          page: this.page - 1,\n          pageSize: this.pageSize\n        }\n      }).then(response => {\n        this.isPending = false\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.desserts = res.data.list\n          this.total = res.data.total\n        }\n      })\n    },\n    addStore () {\n      this.isShowDialog = true\n      this.isUpdate = false\n      this.isReadOnly = false\n      this.$refs.form.reset()\n    },\n    viewStore (info) {\n      this.isReadOnly = true\n      this.updateStore(info)\n    },\n    updateStore (info) {\n      this.isShowDialog = true\n      this.isUpdate = true\n      this.currentStoreId = info.id\n      this.storeInfo.name = info.name\n      this.storeInfo.address = info.address\n      this.storeInfo.telephone = info.telephone\n    },\n    update () {\n      this.isReadOnly = false\n    },\n    submit () {\n      let mode = this.isUpdate ? 'change_store' : 'add_store'\n      let data = {\n        mode\n      }\n      if (this.isUpdate) {\n        data.id = this.currentStoreId\n        data.name = this.storeInfo.name\n        data.address = this.storeInfo.address\n        data.telephone = this.storeInfo.telephone\n      } else {\n        data.userid = this.merchantId\n        data.stores = JSON.stringify(new Array(this.storeInfo))\n      }\n      this.$http({\n        url: '/travel/merchant/options',\n        method: 'POST',\n        data: qs.stringify(data)\n      }).then(response => {\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.isShowDialog = false\n          this.fetchData()\n        } else {\n          this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: res.respmsg,\n            alertType: 'error'\n          })\n        }\n      })\n    },\n    reset () {\n      this.$refs.form.reset()\n    }\n  }\n}\n",{"version":3,"sources":["Store.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Store.vue","sourceRoot":"src/pages/welfare/views","sourcesContent":["<template>\n  <div class=\"store\">\n    <v-layout align-center justify-space-between style=\"height:64px\">\n      <strong class=\"pl-2\">{{merchantName}}</strong>\n      <v-btn @click=\"addStore()\" color=\"primary\" dark>新增门店</v-btn>\n    </v-layout>\n    <v-data-table\n      :headers=\"headers\"\n      :items=\"desserts\"\n      :loading=\"isPending\"\n      hide-actions\n      class=\"elevation-1\"\n    >\n      <template slot=\"items\" slot-scope=\"props\">\n        <td>{{ props.item.name }}</td>\n        <td>{{ props.item.address }}</td>\n        <td>{{ props.item.telephone }}</td>\n        <td>\n          <v-btn flat icon color=\"primary\" class=\"mx-0\" @click=\"viewStore(props.item)\">\n            <v-icon small>details</v-icon>\n          </v-btn>\n        </td>\n      </template>\n      <template slot=\"no-data\">\n        <p style=\"text-align:center;padding-top:16px;\">暂无数据</p>\n      </template>\n    </v-data-table>\n    <div class=\"pagination-container\">\n      <span class=\"pagination-total\">共 {{total}} 条</span>\n      <v-select\n        v-model=\"pageSize\"\n        :items=\"selectItems\"\n        @change=\"fetchData()\"\n        height=\"20\"\n        label=\"10页/条\"\n        solo\n      ></v-select>\n      <v-pagination\n        v-model=\"page\"\n        @input=\"fetchData()\"\n        :length=\"parseInt(total / pageSize) + 1\"\n        :total-visible=\"7\"\n      ></v-pagination>\n    </div>\n\n    <v-dialog\n      v-model=\"isShowDialog\"\n      fullscreen\n      hide-overlay\n      transition=\"dialog-bottom-transition\"\n    >\n      <v-toolbar card dark color=\"primary\">\n        <v-toolbar-title v-if=\"isReadOnly\">门店详情</v-toolbar-title>\n        <v-toolbar-title v-else>{{isUpdate ? '修改门店' : '新增门店'}}</v-toolbar-title>\n        <v-spacer></v-spacer>\n        <v-btn icon dark @click.native=\"isShowDialog = false\">\n          <v-icon>close</v-icon>\n        </v-btn>\n      </v-toolbar>\n      <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n        <v-text-field label=\"门店名称\" :readonly=\"isReadOnly\" counter=\"40\" :rules=\"formRulse.nameRules\" v-model=\"storeInfo.name\"/>\n        <v-text-field label=\"地址\" :readonly=\"isReadOnly\" counter=\"100\" :rules=\"formRulse.addressRules\" v-model=\"storeInfo.address\"/>\n        <v-text-field label=\"电话\" :readonly=\"isReadOnly\" v-model=\"storeInfo.telephone\"/>\n        <div v-if=\"isReadOnly\" style=\"text-align:right;\">\n          <v-btn @click=\"update()\" color=\"primary\">编辑</v-btn>\n        </div>\n        <div v-else style=\"text-align:right;\">\n          <v-btn :disabled=\"!valid\" @click=\"submit()\" color=\"primary\">保存</v-btn>\n          <v-btn @click=\"reset()\">重置</v-btn>\n        </div>\n      </v-form>\n    </v-dialog>\n\n  </div>\n</template>\n\n<script>\nimport qs from 'qs'\nexport default {\n  data () {\n    return {\n      merchantId: '',\n      merchantName: '',\n      headers: [\n        { text: '门店名称', value: 'name', sortable: false },\n        { text: '地址', value: 'area', sortable: false },\n        { text: '电话', value: 'logo', sortable: false },\n        { text: '操作', value: 'id', sortable: false }\n      ],\n      isPending: false,\n      desserts: [],\n      total: 0,\n      page: 1,\n      pageSize: 10,\n      selectItems: [{\n        value: 10,\n        text: '10条/页'\n      }, {\n        value: 20,\n        text: '20条/页'\n      }, {\n        value: 50,\n        text: '50条/页'\n      }],\n      isShowDialog: false, // 新增弹框\n      isReadOnly: false, // 详情\n      currentStoreId: '',\n      isUpdate: false, // 修改\n      valid: false,\n      storeInfo: {\n        name: '',\n        address: '',\n        telephone: ''\n      },\n      formRulse: {\n        nameRules: [\n          v => !!v || '门店名称不能为空'\n        ],\n        addressRules: [\n          v => !!v || '地址不能为空'\n        ]\n      }\n    }\n  },\n  created () {\n    let merchantId = this.$route.params.merchantId\n    this.merchantId = merchantId\n    this.merchantName = window.sessionStorage.getItem('merchantName')\n    this.fetchData(merchantId)\n  },\n  methods: {\n    fetchData (merchantId) {\n      this.isPending = true\n      this.$http({\n        url: '/travel/store/info',\n        method: 'GET',\n        params: {\n          userid: this.merchantId,\n          page: this.page - 1,\n          pageSize: this.pageSize\n        }\n      }).then(response => {\n        this.isPending = false\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.desserts = res.data.list\n          this.total = res.data.total\n        }\n      })\n    },\n    addStore () {\n      this.isShowDialog = true\n      this.isUpdate = false\n      this.isReadOnly = false\n      this.$refs.form.reset()\n    },\n    viewStore (info) {\n      this.isReadOnly = true\n      this.updateStore(info)\n    },\n    updateStore (info) {\n      this.isShowDialog = true\n      this.isUpdate = true\n      this.currentStoreId = info.id\n      this.storeInfo.name = info.name\n      this.storeInfo.address = info.address\n      this.storeInfo.telephone = info.telephone\n    },\n    update () {\n      this.isReadOnly = false\n    },\n    submit () {\n      let mode = this.isUpdate ? 'change_store' : 'add_store'\n      let data = {\n        mode\n      }\n      if (this.isUpdate) {\n        data.id = this.currentStoreId\n        data.name = this.storeInfo.name\n        data.address = this.storeInfo.address\n        data.telephone = this.storeInfo.telephone\n      } else {\n        data.userid = this.merchantId\n        data.stores = JSON.stringify(new Array(this.storeInfo))\n      }\n      this.$http({\n        url: '/travel/merchant/options',\n        method: 'POST',\n        data: qs.stringify(data)\n      }).then(response => {\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.isShowDialog = false\n          this.fetchData()\n        } else {\n          this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: res.respmsg,\n            alertType: 'error'\n          })\n        }\n      })\n    },\n    reset () {\n      this.$refs.form.reset()\n    }\n  }\n}\n</script>\n"]}]}