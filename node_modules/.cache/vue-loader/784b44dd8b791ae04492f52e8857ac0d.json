{"remainingRequest":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/Merchant.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/Merchant.vue","mtime":1547889925000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n// @ is an alias to /src\nimport UploadImage from '../components/UploadImage'\nimport qs from 'qs'\nexport default {\n  components: {\n    UploadImage\n  },\n  data () {\n    return {\n      headers: [\n        { text: '商户ID', value: 'id', sortable: false },\n        { text: '商户名称', value: 'name', sortable: false },\n        { text: '所属地区', value: 'area', sortable: false },\n        { text: 'logo', value: 'logo', sortable: false },\n        { text: '门店', value: 'id', sortable: false },\n        { text: '详情', value: 'id', sortable: false }\n      ],\n      desserts: [],\n      total: 0,\n      page: 1,\n      pageSize: 10,\n      selectItems: [{\n        value: 10,\n        text: '10条/页'\n      }, {\n        value: 20,\n        text: '20条/页'\n      }, {\n        value: 50,\n        text: '50条/页'\n      }],\n      isShowDialog: false, // 新增弹框\n      isReadOnly: false,\n      isUpdate: false,\n      valid: false,\n      isPending: false,\n      merchantInfo: {\n        name: '',\n        area: ''\n      },\n      formRulse: {\n        nameRules: [\n          v => !!v || '商户名称不能为空',\n          v => (v && v.length <= 40) || '40字以内'\n        ],\n        areaRules: [\n          v => !!v || '商户地区不能为空'\n        ]\n      },\n      selectAreas: [{\n        value: 'DB',\n        text: '迪拜'\n      }, {\n        value: 'HK',\n        text: '香港'\n      }, {\n        value: 'JP',\n        text: '日本'\n      }, {\n        value: 'TH',\n        text: '泰国'\n      }],\n      imgShow: false, // 点击查看大图\n      imgSrc: ''\n    }\n  },\n  created () {\n    this.fetchData()\n  },\n  methods: {\n    fetchData () {\n      this.isPending = true\n      this.$http({\n        url: '/travel/merchant/info',\n        method: 'GET',\n        params: {\n          page: this.page - 1,\n          pageSize: this.pageSize\n        }\n      }).then(response => {\n        this.isPending = false\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.desserts = res.data.list\n          this.total = res.data.total\n        }\n      })\n    },\n    showImg (src) {\n      this.imgShow = true\n      this.imgSrc = src || 'https://near.qfpay.com.cn/40F12F92A55747B8AD759E05968A331D/0/upload/c605e72dd75747d1b583c8946b4eed9d.png'\n    },\n    goStore (id, name) {\n      window.sessionStorage.setItem('merchantName', name)\n      this.$router.push({\n        name: 'store',\n        params: {\n          merchantId: id\n        }\n      })\n    },\n    addButton () {\n      this.isShowDialog = true\n      this.isReadOnly = false\n      this.isUpdate = false\n      this.reset()\n    },\n    viewMerchant (info) {\n      this.isReadOnly = true\n      this.merchantInfo.id = info.id\n      this.$refs.uploadimage.modifyStatus.splice(0, 1, false)\n      this.updateMerchant(info)\n    },\n    updateMerchant (info) {\n      this.isShowDialog = true\n      this.isUpdate = true\n      this.merchantInfo.name = info.user\n      this.merchantInfo.area = info.area\n      this.$refs.uploadimage.previewImages.splice(0, 1, info.logo)\n      this.$refs.uploadimage.showAddBtn = false\n    },\n    update () {\n      this.isReadOnly = false\n    },\n    submit () {\n      if (!this.$refs.form.validate()) {\n        return\n      }\n      this.isPending = true\n      let logoUrl = this.$refs.uploadimage.previewImages[0] || ''\n      let params = {\n        user: this.merchantInfo.name,\n        area: this.merchantInfo.area,\n        logo: logoUrl\n      }\n      if (this.isUpdate) {\n        params.mode = 'change_user'\n        params.id = this.merchantInfo.id\n      } else {\n        params.mode = 'add_user'\n      }\n      this.$http({\n        url: '/travel/merchant/options',\n        method: 'POST',\n        data: qs.stringify(params)\n      }).then(response => {\n        this.isPending = false\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.isShowDialog = false\n          this.reset()\n          this.fetchData()\n        } else {\n          this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: '修改商品成功',\n            alertType: 'error'\n          })\n        }\n      })\n    },\n    reset () {\n      this.$refs.form.reset()\n      this.isPending = false\n      this.$refs.uploadimage.previewImages.splice(0, 1)\n      this.$refs.uploadimage.showAddBtn = true\n    }\n  }\n}\n",{"version":3,"sources":["Merchant.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Merchant.vue","sourceRoot":"src/pages/welfare/views","sourcesContent":["<template>\n  <div class=\"merchant\">\n    <v-layout align-center justify-end style=\"height:64px\">\n      <v-btn @click=\"addButton()\" color=\"primary\" dark>新增商户</v-btn>\n    </v-layout>\n    <v-data-table\n      :headers=\"headers\"\n      :items=\"desserts\"\n      :loading=\"isPending\"\n      hide-actions\n      class=\"elevation-1\"\n    >\n      <template slot=\"items\" slot-scope=\"props\">\n        <td>{{ props.item.id }}</td>\n        <td>{{ props.item.user }}</td>\n        <td>{{ props.item.area | formatArea }}</td>\n        <td>\n          <v-img @click=\"showImg(props.item.logo)\" class=\"c-p my-1\" :src=\"props.item.logo ? props.item.logo : 'https://near.qfpay.com.cn/40F12F92A55747B8AD759E05968A331D/0/upload/c605e72dd75747d1b583c8946b4eed9d.png'\" max-width=\"50px\" aspect-ratio=\"1\"/>\n        </td>\n        <td>\n          <v-btn flat icon color=\"primary\" class=\"mx-0\" @click=\"goStore(props.item.id, props.item.user)\">\n            <v-icon small>store</v-icon>\n          </v-btn>\n        </td>\n        <td>\n          <v-btn flat icon color=\"primary\" class=\"mx-0\" @click=\"viewMerchant(props.item)\">\n            <v-icon small>details</v-icon>\n          </v-btn>\n        </td>\n      </template>\n      <template slot=\"no-data\">\n        <p style=\"text-align:center;padding-top:16px;\">暂无数据</p>\n      </template>\n    </v-data-table>\n    <div class=\"pagination-container\">\n      <span class=\"pagination-total\">共 {{total}} 条</span>\n      <v-select\n        v-model=\"pageSize\"\n        :items=\"selectItems\"\n        @change=\"fetchData()\"\n        height=\"20\"\n        label=\"10页/条\"\n        solo\n      ></v-select>\n      <v-pagination\n        v-model=\"page\"\n        @input=\"fetchData()\"\n        :length=\"parseInt(total / pageSize) + 1\"\n        :total-visible=\"7\"\n      ></v-pagination>\n    </div>\n\n    <v-dialog v-model=\"imgShow\" max-width=\"400px\">\n      <v-img :src='imgSrc' max-width=\"100%\" aspect-ratio=\"1\"/>\n    </v-dialog>\n\n    <v-dialog\n      v-model=\"isShowDialog\"\n      fullscreen\n      hide-overlay\n      transition=\"dialog-bottom-transition\"\n    >\n      <v-toolbar card dark color=\"primary\">\n        <v-toolbar-title v-if=\"isReadOnly\">商户详情</v-toolbar-title>\n        <v-toolbar-title v-else>{{isUpdate ? '修改商户' : '新增商户'}}</v-toolbar-title>\n        <v-spacer></v-spacer>\n        <v-btn icon dark @click.native=\"isShowDialog = false\">\n          <v-icon>close</v-icon>\n        </v-btn>\n      </v-toolbar>\n      <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n        <v-text-field v-if=\"isReadOnly\" label=\"商户ID\" readonly v-model=\"merchantInfo.id\"></v-text-field>\n        <v-text-field label=\"商户名称\" counter=\"40\" :readonly=\"isReadOnly\" :rules=\"formRulse.nameRules\" v-model=\"merchantInfo.name\"></v-text-field>\n        <v-select\n          label=\"地区\"\n          :readonly=\"isReadOnly\"\n          v-model=\"merchantInfo.area\"\n          :rules=\"formRulse.areaRules\"\n          :items=\"selectAreas\"\n          required\n        ></v-select>\n        <uploadImage label=\"logo\" :readonly=\"isReadOnly\" ref=\"uploadimage\" :maxNumber=\"1\"/>\n        <p class=\"pt-2\" style=\"color:rgba(0,0,0,.54)\">* jpg格式，200k以内，推荐尺寸200*200</p>\n        <div v-if=\"isReadOnly\" style=\"text-align:right;\">\n          <v-btn @click=\"update()\" color=\"primary\">编辑</v-btn>\n        </div>\n        <div v-else style=\"text-align:right;\">\n          <v-btn :disabled=\"!valid || isPending\" @click=\"submit()\" color=\"primary\">保存</v-btn>\n          <v-btn @click=\"reset()\">重置</v-btn>\n        </div>\n      </v-form>\n    </v-dialog>\n\n  </div>\n</template>\n\n<script>\n// @ is an alias to /src\nimport UploadImage from '../components/UploadImage'\nimport qs from 'qs'\nexport default {\n  components: {\n    UploadImage\n  },\n  data () {\n    return {\n      headers: [\n        { text: '商户ID', value: 'id', sortable: false },\n        { text: '商户名称', value: 'name', sortable: false },\n        { text: '所属地区', value: 'area', sortable: false },\n        { text: 'logo', value: 'logo', sortable: false },\n        { text: '门店', value: 'id', sortable: false },\n        { text: '详情', value: 'id', sortable: false }\n      ],\n      desserts: [],\n      total: 0,\n      page: 1,\n      pageSize: 10,\n      selectItems: [{\n        value: 10,\n        text: '10条/页'\n      }, {\n        value: 20,\n        text: '20条/页'\n      }, {\n        value: 50,\n        text: '50条/页'\n      }],\n      isShowDialog: false, // 新增弹框\n      isReadOnly: false,\n      isUpdate: false,\n      valid: false,\n      isPending: false,\n      merchantInfo: {\n        name: '',\n        area: ''\n      },\n      formRulse: {\n        nameRules: [\n          v => !!v || '商户名称不能为空',\n          v => (v && v.length <= 40) || '40字以内'\n        ],\n        areaRules: [\n          v => !!v || '商户地区不能为空'\n        ]\n      },\n      selectAreas: [{\n        value: 'DB',\n        text: '迪拜'\n      }, {\n        value: 'HK',\n        text: '香港'\n      }, {\n        value: 'JP',\n        text: '日本'\n      }, {\n        value: 'TH',\n        text: '泰国'\n      }],\n      imgShow: false, // 点击查看大图\n      imgSrc: ''\n    }\n  },\n  created () {\n    this.fetchData()\n  },\n  methods: {\n    fetchData () {\n      this.isPending = true\n      this.$http({\n        url: '/travel/merchant/info',\n        method: 'GET',\n        params: {\n          page: this.page - 1,\n          pageSize: this.pageSize\n        }\n      }).then(response => {\n        this.isPending = false\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.desserts = res.data.list\n          this.total = res.data.total\n        }\n      })\n    },\n    showImg (src) {\n      this.imgShow = true\n      this.imgSrc = src || 'https://near.qfpay.com.cn/40F12F92A55747B8AD759E05968A331D/0/upload/c605e72dd75747d1b583c8946b4eed9d.png'\n    },\n    goStore (id, name) {\n      window.sessionStorage.setItem('merchantName', name)\n      this.$router.push({\n        name: 'store',\n        params: {\n          merchantId: id\n        }\n      })\n    },\n    addButton () {\n      this.isShowDialog = true\n      this.isReadOnly = false\n      this.isUpdate = false\n      this.reset()\n    },\n    viewMerchant (info) {\n      this.isReadOnly = true\n      this.merchantInfo.id = info.id\n      this.$refs.uploadimage.modifyStatus.splice(0, 1, false)\n      this.updateMerchant(info)\n    },\n    updateMerchant (info) {\n      this.isShowDialog = true\n      this.isUpdate = true\n      this.merchantInfo.name = info.user\n      this.merchantInfo.area = info.area\n      this.$refs.uploadimage.previewImages.splice(0, 1, info.logo)\n      this.$refs.uploadimage.showAddBtn = false\n    },\n    update () {\n      this.isReadOnly = false\n    },\n    submit () {\n      if (!this.$refs.form.validate()) {\n        return\n      }\n      this.isPending = true\n      let logoUrl = this.$refs.uploadimage.previewImages[0] || ''\n      let params = {\n        user: this.merchantInfo.name,\n        area: this.merchantInfo.area,\n        logo: logoUrl\n      }\n      if (this.isUpdate) {\n        params.mode = 'change_user'\n        params.id = this.merchantInfo.id\n      } else {\n        params.mode = 'add_user'\n      }\n      this.$http({\n        url: '/travel/merchant/options',\n        method: 'POST',\n        data: qs.stringify(params)\n      }).then(response => {\n        this.isPending = false\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.isShowDialog = false\n          this.reset()\n          this.fetchData()\n        } else {\n          this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: '修改商品成功',\n            alertType: 'error'\n          })\n        }\n      })\n    },\n    reset () {\n      this.$refs.form.reset()\n      this.isPending = false\n      this.$refs.uploadimage.previewImages.splice(0, 1)\n      this.$refs.uploadimage.showAddBtn = true\n    }\n  }\n}\n</script>\n"]}]}