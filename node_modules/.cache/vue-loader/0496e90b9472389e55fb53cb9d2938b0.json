{"remainingRequest":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/common/CouponAdd.vue?vue&type=style&index=0&id=031edbbf&scoped=true&lang=css&","dependencies":[{"path":"/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/common/CouponAdd.vue","mtime":1547889925000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/@vue/cli-service/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/postcss-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.line-h-50{line-height: 50px;}\n.text-field-cus{margin: 0 10px 0 50px;padding: 0;width: 300px;flex-grow: 0;flex-shrink: 0;}\n.layout-row-cus{width: 50%;margin: 0 auto;flex-grow: 0;}\n.banner-form{margin: 0 auto;}\n.chip-like-div{\n  padding: 5px 10px;\n  border: 1px solid;\n  background: #4caf50 ;\n  display: inline-block;\n  border-radius: 5px;\n  color: white;\n}\n.chip-like-icon{\n  margin-left: 5px;\n}\n",{"version":3,"sources":["CouponAdd.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAscA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CouponAdd.vue","sourceRoot":"src/pages/welfare/views/common","sourcesContent":["<template>\n  <v-layout row justify-end>\n    <v-dialog v-model=\"dialog\" fullscreen hide-overlay transition=\"dialog-bottom-transition\">\n      <v-btn slot=\"activator\" color=\"primary\" v-if=\"item\">\n        编辑\n      </v-btn>\n      <v-btn slot=\"activator\" color=\"primary\" dark v-else>新增优惠券</v-btn>\n      <v-toolbar dark color=\"primary\" class=\"cus-toolbar\">\n        <v-toolbar-title align-self-center v-if=\"item\">编辑优惠券</v-toolbar-title>\n        <v-toolbar-title align-self-center v-else>新增优惠券</v-toolbar-title>\n        <v-btn icon dark @click.native=\"dialog = false\">\n          <v-icon>close</v-icon>\n        </v-btn>\n      </v-toolbar>\n      <v-form ref=\"form\" v-model=\"valid\" lazy-validation class=\"banner-form\">\n        <v-text-field\n          v-model=\"name\"\n          :rules=\"nameRules\"\n          :counter=\"40\"\n          label=\"名称\"\n          required\n        ></v-text-field>\n        <v-layout row align-end>\n          <uploadImage ref=\"uploadimage1\" :maxNumber='1' class=\"mr-2\" label=\"首页图片\"/>\n          <p class=\"ma-0 pa-0 line-h-50\"><span>*&nbsp;</span>jpg格式，1张，不超过200k，推荐尺寸</p>\n        </v-layout>\n        <v-text-field\n          v-model=\"term\"\n          :rules=\"termRules\"\n          :counter=\"40\"\n          label=\"使用条件\"\n          required\n        ></v-text-field>\n        <v-textarea\n          v-model=\"intro\"\n          :rules=\"introRules\"\n          label=\"描述\"\n          counter=\"400\"\n        ></v-textarea>\n        <v-layout row align-end>\n          <uploadImage ref=\"uploadimage2\" :maxNumber='1' class=\"mr-2\" label=\"详情图片\"/>\n          <p class=\"ma-0 pa-0 line-h-50\"><span>*&nbsp;</span>jpg格式，1张，不超过200k，推荐尺寸</p>\n        </v-layout>\n        <v-text-field\n          v-model=\"total\"\n          :rules=\"totalRules\"\n          label=\"库存\"\n          required\n        ></v-text-field>\n        <v-layout row flex-end>\n          <!-- 日期 -->\n          <v-layout row wrap class=\"v-btn-cus\" justify-space-between>\n            <v-flex xs11 sm5>\n        <v-menu\n          ref=\"menu1\"\n          :close-on-content-click=\"false\"\n          v-model=\"menu1\"\n          :nudge-right=\"40\"\n          lazy\n          transition=\"scale-transition\"\n          offset-y\n          full-width\n          max-width=\"290px\"\n          min-width=\"290px\"\n        >\n          <v-text-field\n            slot=\"activator\"\n            v-model=\"dateFormatted\"\n            label=\"开始日期\"\n            persistent-hint\n            prepend-icon=\"event\"\n            @blur=\"date1 = parseDate(dateFormatted)\"\n          ></v-text-field>\n          <v-date-picker :max=\"date2\" v-model=\"date1\" no-title @input=\"menu1 = false\"></v-date-picker>\n        </v-menu>\n      </v-flex>\n\n      <v-flex xs11 sm5>\n        <v-menu\n          :close-on-content-click=\"false\"\n          v-model=\"menu2\"\n          :nudge-right=\"40\"\n          lazy\n          transition=\"scale-transition\"\n          offset-y\n          full-width\n          max-width=\"290px\"\n          min-width=\"290px\"\n        >\n          <v-text-field\n            slot=\"activator\"\n            v-model=\"computedDateFormatted\"\n            label=\"结束日期\"\n            persistent-hint\n            prepend-icon=\"event\"\n            @blur=\"date2 = parseDate(computedDateFormatted)\"\n          ></v-text-field>\n          <v-date-picker :min=\"date1\" v-model=\"date2\" no-title @input=\"menu2 = false\"></v-date-picker>\n        </v-menu>\n      </v-flex>\n          </v-layout>\n        </v-layout>\n        <v-layout row flex-end>\n          <!-- 时间 -->\n          <v-layout row wrap class=\"v-btn-cus\" justify-space-between>\n            <v-flex xs11 sm5>\n              <v-menu\n                ref=\"menu3\"\n                :close-on-content-click=\"false\"\n                v-model=\"menu3\"\n                :nudge-right=\"40\"\n                :return-value.sync=\"time1\"\n                lazy\n                transition=\"scale-transition\"\n                offset-y\n                full-width\n                min-width=\"290px\"\n              >\n                <v-text-field\n                  slot=\"activator\"\n                  v-model=\"time1\"\n                  label=\"开始时间\"\n                  prepend-icon=\"access_time\"\n                  readonly\n                ></v-text-field>\n                <v-time-picker\n                  format=\"24hr\"\n                  v-if=\"menu3\"\n                  v-model=\"time1\"\n                  full-width\n                  :max=\"time2\"\n                  @change=\"$refs.menu3.save(time1)\"\n                ></v-time-picker>\n              </v-menu>\n            </v-flex>\n            <v-flex xs11 sm5>\n              <v-menu\n                ref=\"menu4\"\n                :close-on-content-click=\"false\"\n                v-model=\"menu4\"\n                :nudge-right=\"40\"\n                :return-value.sync=\"time2\"\n                lazy\n                transition=\"scale-transition\"\n                offset-y\n                full-width\n                min-width=\"290px\"\n              >\n                <v-text-field\n                  slot=\"activator\"\n                  v-model=\"time2\"\n                  label=\"结束时间\"\n                  prepend-icon=\"access_time\"\n                  readonly\n                ></v-text-field>\n                <v-time-picker\n                  format=\"24hr\"\n                  v-if=\"menu4\"\n                  v-model=\"time2\"\n                  full-width\n                  :min=\"time1\"\n                  @change=\"$refs.menu4.save(time2)\"\n                ></v-time-picker>\n              </v-menu>\n            </v-flex>\n          </v-layout>\n        </v-layout>\n        <v-text-field\n          v-model=\"userid\"\n          :rules=\"useridRules\"\n          label=\"关联商户id\"\n          required\n          @blur=\"useridInput()()\"\n          @change=\"modelClean\"\n        ></v-text-field>\n        <v-layout row align-end>\n          <v-select\n            v-model=\"model\"\n            :items=\"exchange\"\n            item-text=\"name\"\n            item-value=\"id\"\n            chips\n            no-data-text=\"暂无数据\"\n            placeholder=\"请选择门店\"\n            label=\"选择门店\"\n            return-object\n            multiple\n          ></v-select>\n        </v-layout>\n        <v-layout row wrap>\n          <v-flex v-for=\"(_item, _index) in model\" :key=\"_index\">\n            <div class=\"chip-like-div\">\n              <span>{{_item.name}}</span>\n              <v-icon color=\"white\" @click=\"chipCtrl(_item)\" small class=\"chip-like-icon\">close</v-icon>\n            </div>\n          </v-flex>\n        </v-layout>\n        <v-btn\n          :disabled=\"!valid\"\n          @click=\"submit\"\n          color=\"primary\"\n          :loading=\"submitLoading\"\n        >\n          保存\n        </v-btn>\n        <v-btn @click=\"cancel\">取消</v-btn>\n      </v-form>\n    </v-dialog>\n  </v-layout>\n</template>\n<script>\nimport UploadImage from '../../components/UploadImage'\nimport Http from '@/http'\nexport default {\n  props: [\n    'item'\n  ],\n  data () {\n    return {\n      dialog: false,\n      valid: true,\n      name: '',\n      nameRules: [\n        v => !!v || '请填写名称',\n        v => (v && v.length <= 40) || '最多40个字'\n      ],\n      introRules: [\n        v => (v && v.length <= 400) || '最多400个字'\n      ],\n      term: '',\n      termRules: [\n        v => !!v || '请填写使用条件',\n        v => (v && v.length <= 40) || '最多40个字'\n      ],\n      intro: '',\n      total: '',\n      totalRules: [\n        v => (!!v && (v > 0)) || '请填写库存',\n        v => /^[0-9]*$/.test(v) || '请填写数字'\n      ],\n      userid: '',\n      useridRules: [\n        v => !!v || '请填写关联商户id'\n      ],\n      imgs1: [],\n      imgs2: [],\n      dates: [],\n      menu: false,\n      menu1: false,\n      time1: null,\n      time2: null,\n      menu2: false,\n      menu3: false,\n      menu4: false,\n      isLoading: false,\n      model: null,\n      search: null,\n      exchange: [],\n      timer: null,\n      date1: '',\n      date2: '',\n      storeData: [],\n      submitLoading: false\n    }\n  },\n  computed: {\n    computedDateFormatted: {\n      get () {\n        return this.formatDate(this.date2)\n      },\n      set () {\n        return this.formatDate(this.date2)\n      }\n    },\n    dateFormatted: {\n      get () {\n        return this.formatDate(this.date1)\n      },\n      set () {\n        return this.formatDate(this.date1)\n      }\n    }\n  },\n  methods: {\n    formatDate (date) {\n      if (!date) return null\n      const [year, month, day] = date.split('-')\n      return `${year}-${month}-${day}`\n    },\n    parseDate (date) {\n      if (!date) return null\n      const [month, day, year] = date.split('/')\n      return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`\n    },\n    chipCtrl (item) {\n      let index = this.model.indexOf(item)\n      this.model.splice(index, 1)\n    },\n    modelClean () {\n      this.model = ''\n    },\n    async useridInput () {\n      let res = await Http.post('/travel/goods/options', {\n        id: this.userid,\n        mode: 'shop_info'\n      })\n      if (res && res.data) {\n        if (res.data.respcd === '0000') {\n          let data = [...res.data.data]\n          let exchange = []\n          data.map(item => {\n            exchange.push({\n              name: item.name,\n              id: item.id\n            })\n          })\n          this.storeData = [...data]\n          this.exchange = [...exchange]\n        }\n      }\n    },\n    async submit () {\n      let image = this.$refs.uploadimage1.previewImages[0]\n      if (!image) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请上传首页图片',\n          alertType: 'warning'\n        })\n        return\n      }\n      if (!this.date1) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请选择开始日期',\n          alertType: 'warning'\n        })\n        return\n      }\n      if (!this.date2) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请选择结束日期',\n          alertType: 'warning'\n        })\n        return\n      }\n      let arr = []\n      let obj = {}\n      obj.start_time = this.time1\n      obj.end_time = this.time2\n      arr.push(obj)\n      if ((this.time1 || this.time2) && (!this.time1 || !this.time2)) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请填写完整使用时间段',\n          alertType: 'warning'\n        })\n        return\n      }\n      if (!this.model.length) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '门店不能为空',\n          alertType: 'warning'\n        })\n        return\n      }\n      let details = this.$refs.uploadimage2.previewImages[0]\n      let param = {\n        images: JSON.stringify([image]),\n        details: JSON.stringify([details]),\n        name: this.name,\n        term: this.term,\n        intro: this.intro,\n        total: this.total,\n        userid: this.userid,\n        type: 2,\n        start_date: this.date1,\n        end_date: `${this.date2} 23:59:59`,\n        cut_expire: JSON.stringify(arr),\n        exchange: JSON.stringify(this.model)\n      }\n      let res\n      if (this.$refs.form.validate()) {\n        this.submitLoading = true\n        if (this.item && this.item.id) {\n          param.id = this.item.id\n          param.mode = 'change_info'\n          res = await Http.post('/travel/goods/options', param)\n        } else {\n          param.mode = 'add_info'\n          res = await Http.post('/travel/goods/options', param)\n        }\n        this.submitLoading = false\n        if (res && res.data) {\n          if (res.data.respcd === '0000') {\n            this.$emit('ctrl')\n            this.cancel()\n            this.$store.dispatch('setAlert', {\n              alert: true,\n              alertContent: '操作成功',\n              alertType: 'success'\n            })\n          } else {\n            // 问题提示\n            this.$store.dispatch('setAlert', {\n              alert: true,\n              alertContent: res.data.respmsg,\n              alertType: 'error'\n            })\n          }\n        }\n      }\n    },\n    cancel () {\n      this.dialog = false\n      this.$refs.form.reset()\n      this.$refs.uploadimage1.previewImages = []\n      this.$refs.uploadimage1.showAddBtn = true\n      this.$refs.uploadimage2.previewImages = []\n      this.$refs.uploadimage2.showAddBtn = true\n    }\n  },\n  watch: {\n    'dialog': function (val) {\n      if (val && this.item) {\n        this.name = this.item.name\n        this.term = this.item.term\n        this.intro = this.item.intro\n        this.total = this.item.total\n        this.date1 = this.item.start_date\n        this.date2 = this.item.end_date\n        this.time1 = this.item['cut_expire'][0]['start_time']\n        this.time2 = this.item['cut_expire'][0]['end_time']\n        this.userid = this.item.userid\n        this.model = [...this.item.exchange]\n        this.exchange = [...this.model]\n        this.$refs.uploadimage1.previewImages.splice(0, 1, this.item.images)\n        this.$refs.uploadimage2.previewImages.splice(0, 1, this.item.details)\n        this.$refs.uploadimage1.showAddBtn = false\n        this.$refs.uploadimage2.showAddBtn = false\n      }\n      if (!val) {\n        this.cancel()\n      }\n    }\n  },\n  components: {\n    UploadImage\n  }\n}\n</script>\n<style scoped>\n.line-h-50{line-height: 50px;}\n.text-field-cus{margin: 0 10px 0 50px;padding: 0;width: 300px;flex-grow: 0;flex-shrink: 0;}\n.layout-row-cus{width: 50%;margin: 0 auto;flex-grow: 0;}\n.banner-form{margin: 0 auto;}\n.chip-like-div{\n  padding: 5px 10px;\n  border: 1px solid;\n  background: #4caf50 ;\n  display: inline-block;\n  border-radius: 5px;\n  color: white;\n}\n.chip-like-icon{\n  margin-left: 5px;\n}\n</style>\n"]}]}