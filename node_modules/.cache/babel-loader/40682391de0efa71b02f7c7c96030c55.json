{"remainingRequest":"/Users/dmsun/Desktop/workspace/solar/node_modules/babel-loader/lib/index.js!/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/Goods.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/Goods.vue","mtime":1547889925000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// @ is an alias to /src\nimport UploadImage from '../components/UploadImage';\nimport Comfirm from '@/components/Comfirm';\nimport qs from 'qs';\nexport default {\n  components: {\n    UploadImage: UploadImage,\n    Comfirm: Comfirm\n  },\n  data: function data() {\n    return {\n      headers: [{\n        text: '商品ID',\n        value: 'id',\n        sortable: false\n      }, {\n        text: '商品名称',\n        value: 'name',\n        sortable: false\n      }, {\n        text: '原价',\n        value: 'original',\n        sortable: false\n      }, {\n        text: '现价',\n        value: 'current',\n        sortable: false\n      }, {\n        text: '库存',\n        value: 'total',\n        sortable: false\n      }, {\n        text: '商户',\n        value: 'id',\n        sortable: false\n      }, {\n        text: '地区',\n        value: 'address',\n        sortable: false\n      }, {\n        text: '状态',\n        value: 'status',\n        sortable: false\n      }, {\n        text: '详情',\n        value: 'id',\n        sortable: false\n      }],\n      isPending: false,\n      desserts: [],\n      total: 0,\n      page: 1,\n      pageSize: 10,\n      currentItem: {},\n      // 当前操作 table item\n      showComfirm: false,\n      selectItems: [{\n        value: 10,\n        text: '10条/页'\n      }, {\n        value: 20,\n        text: '20条/页'\n      }, {\n        value: 50,\n        text: '50条/页'\n      }],\n      isShowDialog: false,\n      // 新增弹框\n      isReadOnly: false,\n      isUpdate: false,\n      valid: false,\n      startDatemenu: false,\n      endDatemenu: false,\n      startTimeMenu: false,\n      endTimeMenu: false,\n      goodsInfo: {\n        name: '',\n        images: [],\n        intro: '',\n        details: [],\n        notice: '',\n        start_date: '',\n        end_date: '',\n        startTime: null,\n        endTime: null,\n        exchange: [],\n        userid: ''\n      },\n      stores: [],\n      // 适用门店\n      formRulse: {\n        nameRules: [function (v) {\n          return !!v || '商品名称不能为空';\n        }, function (v) {\n          return v && v.length <= 100 || '100字以内';\n        }],\n        introRules: [function (v) {\n          return v && v.length <= 1000 || '1000字以内';\n        }],\n        originalRules: [function (v) {\n          return !!v || '原价不能为空';\n        }, function (v) {\n          return /^\\d+(\\.\\d{1,2})?$/.test(v) || '原价格式不正确';\n        }],\n        currentRules: [function (v) {\n          return !!v || '现价不能为空';\n        }, function (v) {\n          return /^\\d+(\\.\\d{1,2})?$/.test(v) || '现价格式不正确';\n        }],\n        totalRules: [function (v) {\n          return !!v || '库存不能为空';\n        }, function (v) {\n          return /^[1-9]\\d*$/.test(v) || '库存必须为数值';\n        }],\n        dateRules: [function (v) {\n          return !!v || '有效期不能为空';\n        }],\n        useridRules: [function (v) {\n          return !!v || '关联商户id不能为空';\n        }],\n        srcRules: [function (v) {\n          return !v || v.length <= 10 || '10字以内';\n        }],\n        storesRules: [function (v) {\n          return Array.isArray(v) && v.length > 0 || '兑换门店不能为空';\n        }],\n        noticeRules: [function (v) {\n          return v && v.length <= 400 || '400字以内';\n        }]\n      },\n      currencyErrorMessages: '',\n      useridErrorMessages: ''\n    };\n  },\n  computed: {\n    current_format: {\n      get: function get() {\n        return this.goodsInfo.current / 100 || '';\n      },\n      set: function set(value) {\n        this.goodsInfo.current = value * 100 || '';\n      }\n    },\n    original_format: {\n      get: function get() {\n        return this.goodsInfo.original / 100 || '';\n      },\n      set: function set(value) {\n        this.goodsInfo.original = value * 100 || '';\n      }\n    }\n  },\n  created: function created() {\n    this.fetchData();\n  },\n  methods: {\n    verifyCurrency: function verifyCurrency() {\n      if (!this.goodsInfo.current || !this.goodsInfo.original) {\n        return;\n      }\n\n      if (this.goodsInfo.original < this.goodsInfo.current) {\n        this.currencyErrorMessages = '原价不能小于现价';\n      } else {\n        this.currencyErrorMessages = '';\n      }\n    },\n    fetchData: function fetchData() {\n      var _this = this;\n\n      this.isPending = true;\n      this.$http({\n        url: '/travel/goods/info',\n        method: 'GET',\n        params: {\n          type: 1,\n          pageSize: this.pageSize,\n          page: this.page - 1 // 接口 第一页 page = 0\n\n        }\n      }).then(function (response) {\n        _this.isPending = false;\n        var res = response.data;\n\n        if (res.respcd === '0000') {\n          _this.desserts = res.data.list;\n          _this.total = res.data.total;\n        } else {\n          _this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: res.respmsg,\n            alertType: 'error'\n          });\n        }\n      });\n    },\n    fetchStores: function fetchStores(id, resetSelected) {\n      var _this2 = this;\n\n      if (resetSelected && Number(id) === this.goodsInfo.userid) {\n        return;\n      }\n\n      this.$http({\n        url: '/travel/goods/options',\n        method: 'POST',\n        data: qs.stringify({\n          id: id,\n          mode: 'shop_info'\n        })\n      }).then(function (response) {\n        var res = response.data;\n\n        if (res.respcd === '0000') {\n          _this2.useridErrorMessages = '';\n\n          if (resetSelected) {\n            _this2.stores = [];\n            _this2.goodsInfo.exchange = [];\n          }\n\n          res.data.map(function (item) {\n            _this2.stores.push({\n              id: item.id,\n              name: item.name\n            });\n          });\n        } else if (res.respcd === '2102') {\n          _this2.useridErrorMessages = '该商户不存在，请检查商户id是否正确';\n        } else if (res.respcd === '2101') {\n          _this2.useridErrorMessages = '该商户下没有门店，请先添加门店';\n        }\n      });\n    },\n    addButton: function addButton() {\n      this.reset();\n      this.isReadOnly = false;\n      this.isShowDialog = true;\n      this.isUpdate = false;\n    },\n    goGoodsDetail: function goGoodsDetail(id, name) {\n      window.sessionStorage.setItem('goodsName', name);\n      this.$router.push({\n        name: 'store',\n        params: {\n          goodsId: id\n        }\n      });\n    },\n    viewGoods: function viewGoods(info) {\n      this.isReadOnly = true;\n      this.isShowDialog = true;\n      this.isUpdate = true;\n      this.goodsInfo = _objectSpread({}, info);\n      this.goodsInfo.start_date = info.start_date.substr(0, 10);\n      this.goodsInfo.end_date = info.end_date.substr(0, 10);\n\n      if (info.cut_expire) {\n        this.goodsInfo.startTime = info.cut_expire[0].start_time;\n        this.goodsInfo.endTime = info.cut_expire[0].end_time;\n      }\n\n      delete this.goodsInfo['cut_expire'];\n      this.$refs.uploadimage.previewImages = _toConsumableArray(info.images);\n      this.$refs.uploadetail.previewImages = _toConsumableArray(info.details);\n      this.fetchStores(info.userid, false);\n    },\n    submit: function submit() {\n      var _this3 = this;\n\n      if (!this.$refs.form.validate()) {\n        return;\n      }\n\n      var images = this.$refs.uploadimage.previewImages;\n      var details = this.$refs.uploadetail.previewImages;\n\n      if (images.length === 0) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请上传商品图片',\n          alertType: 'warning'\n        });\n        return false;\n      }\n\n      if (details.length === 0) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请上传商品详情图',\n          alertType: 'warning'\n        });\n        return false;\n      }\n\n      var startTime = this.goodsInfo.startTime;\n      var endTime = this.goodsInfo.endTime;\n\n      if (!!startTime && !endTime || !startTime && !!endTime) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请填写完整使用时间段',\n          alertType: 'warning'\n        });\n        return false;\n      }\n\n      var params = _objectSpread({}, this.goodsInfo);\n\n      params.images = JSON.stringify(images);\n      params.details = JSON.stringify(details);\n      params.exchange = JSON.stringify(params.exchange);\n\n      if (params.start_date.length === 10) {\n        params.start_date += ' 00:00:00';\n      }\n\n      if (params.end_date.length === 10) {\n        params.end_date += ' 23:59:59';\n      }\n\n      params.cut_expire = JSON.stringify(new Array({\n        start_time: params.startTime,\n        end_time: params.endTime\n      }));\n      delete params['startTime'];\n      delete params['endTime'];\n      var mode = this.isUpdate ? 'change_info' : 'add_info';\n      params.mode = mode;\n      params.type = 1;\n      this.$http({\n        url: '/travel/goods/options',\n        method: 'POST',\n        data: qs.stringify(params)\n      }).then(function (response) {\n        var res = response.data;\n\n        if (res.respcd === '0000') {\n          _this3.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: _this3.isUpdate ? '修改商品成功' : '新增商品成功',\n            alertType: 'success'\n          });\n\n          _this3.isShowDialog = false;\n\n          _this3.fetchData();\n        } else {\n          _this3.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: res.respmsg,\n            alertType: 'error'\n          });\n        }\n      });\n    },\n    beforeUpdateStatus: function beforeUpdateStatus(value, id) {\n      var status = value === 1 ? 0 : 1;\n      this.showComfirm = true;\n      this.currentItem = {\n        status: status,\n        id: id\n      };\n    },\n    cancelUpdateStatus: function cancelUpdateStatus() {\n      var _this4 = this;\n\n      this.showComfirm = false;\n      this.desserts.map(function (item) {\n        if (item.id === _this4.currentItem.id) {\n          item.status = _this4.currentItem.status;\n        }\n      });\n    },\n    updateStatus: function updateStatus() {\n      var _this5 = this;\n\n      var status = this.currentItem.status === 1 ? 0 : 1;\n      this.$http({\n        url: '/travel/goods/options',\n        method: 'POST',\n        data: qs.stringify({\n          id: this.currentItem.id,\n          mode: 'change_info',\n          status: status\n        })\n      }).then(function (response) {\n        var res = response.data;\n\n        if (res.respcd === '0000') {\n          _this5.showComfirm = false;\n\n          _this5.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: status === 1 ? '上架商品成功' : '下架商品成功',\n            alertType: 'success',\n            alertColor: status === 1 ? 'primary' : 'rgba(0,0,0,.38)'\n          });\n        }\n      });\n    },\n    reset: function reset() {\n      this.$refs.form.reset();\n      this.useridErrorMessages = '';\n      this.currencyErrorMessages = '';\n      this.$refs.uploadimage.previewImages = [];\n      this.$refs.uploadetail.previewImages = [];\n    }\n  }\n};",{"version":3,"sources":["Goods.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"goods\">\n    <v-layout align-center justify-end style=\"height:64px\">\n      <v-btn @click=\"addButton()\" color=\"primary\" dark>新增商品</v-btn>\n    </v-layout>\n    <v-data-table\n      :headers=\"headers\"\n      :items=\"desserts\"\n      :loading=\"isPending\"\n      hide-actions\n      class=\"elevation-1\"\n    >\n      <template slot=\"items\" slot-scope=\"props\">\n        <td>{{ props.item.id }}</td>\n        <td>{{ props.item.name }}</td>\n        <td>￥{{ props.item.original | formatCurrency }}</td>\n        <td>￥{{ props.item.current | formatCurrency }}</td>\n        <td>{{ props.item.bought }}/{{ props.item.total }}</td>\n        <td>{{ props.item.mchnt }} ({{ props.item.userid }})</td>\n        <td>{{ props.item.area | formatArea }}</td>\n        <td>\n          <v-switch @change=\"beforeUpdateStatus($event, props.item.id)\" v-model=\"props.item.status\" color=\"primary\" :messages=\"props.item.status === 1 ? '已上架' : '已下架'\"  :true-value=\"1\" :false-value=\"0\"></v-switch>\n        </td>\n        <td>\n          <v-btn flat icon color=\"primary\" class=\"mx-0\" @click=\"viewGoods(props.item)\">\n            <v-icon small>details</v-icon>\n          </v-btn>\n        </td>\n      </template>\n      <template slot=\"no-data\">\n        <p style=\"text-align:center;padding-top:16px;\">暂无数据</p>\n      </template>\n    </v-data-table>\n    <div class=\"pagination-container\">\n      <span class=\"pagination-total\">共 {{total}} 条</span>\n      <v-select\n        v-model=\"pageSize\"\n        :items=\"selectItems\"\n        @change=\"fetchData()\"\n        height=\"20\"\n        label=\"10页/条\"\n        solo\n      ></v-select>\n      <v-pagination\n        v-model=\"page\"\n        @input=\"fetchData()\"\n        :length=\"parseInt(total / pageSize) + 1\"\n        :total-visible=\"7\"\n      ></v-pagination>\n    </div>\n\n    <v-dialog\n      v-model=\"isShowDialog\"\n      fullscreen\n      hide-overlay\n      transition=\"dialog-bottom-transition\"\n    >\n      <v-toolbar card dark color=\"primary\">\n        <v-toolbar-title v-if=\"isReadOnly\">商品详情</v-toolbar-title>\n        <v-toolbar-title v-else>{{isUpdate ? '修改商品' : '新增商品'}}</v-toolbar-title>\n        <v-spacer></v-spacer>\n        <v-btn icon dark @click.native=\"isShowDialog = false\">\n          <v-icon>close</v-icon>\n        </v-btn>\n      </v-toolbar>\n      <v-form ref=\"form\" v-model=\"valid\" lazy-validation>\n        <v-text-field label=\"名称\" :readonly=\"isReadOnly\" :rules=\"formRulse.nameRules\" counter=\"100\" v-model=\"goodsInfo.name\"/>\n        <uploadImage label=\"图片\" :readonly=\"isReadOnly\" ref=\"uploadimage\" :maxNumber=\"9\"/>\n        <p class=\"pt-2\" style=\"color:rgba(0,0,0,.54)\">* jpg格式，最多9张，不超过200k, 推荐尺寸254*192</p>\n        <v-textarea label=\"描述\" counter=\"1000\" :readonly=\"isReadOnly\" :rules=\"formRulse.introRules\" auto-grow v-model=\"goodsInfo.intro\"/>\n        <uploadImage label=\"详细图\" :readonly=\"isReadOnly\" ref=\"uploadetail\" :maxNumber=\"9\"/>\n        <p class=\"pt-2\" style=\"color:rgba(0,0,0,.54)\">* jpg格式，最多9张，不超过300k, 推荐尺寸宽400~600，高不限</p>\n        <v-text-field label=\"原价\" ref=\"original\" :readonly=\"isReadOnly\" :rules=\"formRulse.originalRules\" v-model=\"original_format\" @input=\"verifyCurrency()\" :error-messages=\"currencyErrorMessages\"/>\n        <v-text-field label=\"现价\" ref=\"current\" :readonly=\"isReadOnly\" :rules=\"formRulse.currentRules\" v-model=\"current_format\" @input=\"verifyCurrency()\" :error-messages=\"currencyErrorMessages\"/>\n        <v-text-field label=\"库存\" :readonly=\"isReadOnly\" :rules=\"formRulse.totalRules\" v-model=\"goodsInfo.total\"/>\n        <label class=\"custom-label\">有效期</label>\n        <v-layout align-center justify-space-between>\n          <v-menu v-model=\"startDatemenu\" :disabled=\"isReadOnly\" transition=\"scale-transition\" :close-on-content-click=\"false\" style=\"width:260px\">\n            <v-text-field append-icon=\"event\" :rules=\"formRulse.dateRules\" slot=\"activator\" readonly label=\"开始日期\" v-model=\"goodsInfo.start_date\"></v-text-field>\n            <v-date-picker color=\"primary\" v-model=\"goodsInfo.start_date\" :max=\"goodsInfo.end_date\" locale=\"zh-Hans\" no-title @input=\"startDatemenu = false\"></v-date-picker>\n          </v-menu>\n          <v-menu v-model=\"endDatemenu\" :disabled=\"isReadOnly\" transition=\"scale-transition\" :close-on-content-click=\"false\" style=\"width:260px\">\n            <v-text-field append-icon=\"event\" :rules=\"formRulse.dateRules\" slot=\"activator\" readonly label=\"结束日期\" v-model=\"goodsInfo.end_date\"></v-text-field>\n            <v-date-picker color=\"primary\" v-model=\"goodsInfo.end_date\" :min=\"goodsInfo.start_date\" locale=\"zh-Hans\" no-title @input=\"endDatemenu = false\"></v-date-picker>\n          </v-menu>\n        </v-layout>\n        <label class=\"custom-label\">使用时间段</label>\n        <v-layout align-center justify-space-between>\n          <v-menu ref=\"startmenu\" v-model=\"startTimeMenu\" :disabled=\"isReadOnly\" :close-on-content-click=\"false\" transition=\"scale-transition\" style=\"width:260px\">\n            <v-text-field label=\"开始时间\" ref=\"startime\" append-icon=\"event\" slot=\"activator\" readonly v-model=\"goodsInfo.startTime\"></v-text-field>\n            <v-time-picker v-if=\"startTimeMenu\" v-model=\"goodsInfo.startTime\" :max=\"goodsInfo.endTime\" format=\"24hr\" no-title @change=\"$refs.startmenu.save(goodsInfo.startTime)\"></v-time-picker>\n          </v-menu>\n          <v-menu ref=\"endmenu\" v-model=\"endTimeMenu\" :disabled=\"isReadOnly\" :close-on-content-click=\"false\" transition=\"scale-transition\" style=\"width:260px\">\n            <v-text-field label=\"结束时间\" ref=\"endtime\" append-icon=\"event\" slot=\"activator\" readonly v-model=\"goodsInfo.endTime\"></v-text-field>\n            <v-time-picker v-if=\"endTimeMenu\" v-model=\"goodsInfo.endTime\" :min=\"goodsInfo.startTime\" format=\"24hr\" no-title @change=\"$refs.endmenu.save(goodsInfo.endTime)\"></v-time-picker>\n          </v-menu>\n        </v-layout>\n        <v-textarea label=\"注意事项\" :readonly=\"isReadOnly\" counter=\"400\" :rules=\"formRulse.noticeRules\" auto-grow v-model=\"goodsInfo.notice\"></v-textarea>\n        <v-text-field label=\"商品来源\" :readonly=\"isReadOnly\" :counter=\"goodsInfo.src ? 10 : undefined\" :rules=\"formRulse.srcRules\" v-model=\"goodsInfo.src\"/>\n        <v-text-field label=\"关联商户id\" :readonly=\"isReadOnly\" :rules=\"formRulse.useridRules\" v-model=\"goodsInfo.userid\" :error-messages=\"useridErrorMessages\" @blur=\"fetchStores($event.target.value, true)\"/>\n        <v-select\n          label=\"兑换门店\"\n          :items=\"stores\"\n          item-text=\"name\"\n          item-value=\"id\"\n          :rules=\"formRulse.storesRules\"\n          v-model=\"goodsInfo.exchange\"\n          multiple\n          return-object\n          chips\n        ></v-select>\n        <div v-if=\"isReadOnly\" style=\"text-align:right;\">\n          <v-btn @click=\"isReadOnly = false\" color=\"primary\">编辑</v-btn>\n        </div>\n        <div v-else style=\"text-align:right;\">\n          <v-btn :disabled=\"!valid\" @click=\"submit()\" color=\"primary\">保存</v-btn>\n          <v-btn @click=\"reset()\">重置</v-btn>\n        </div>\n      </v-form>\n    </v-dialog>\n    <comfirm @okHandler=\"updateStatus()\" @cancelHandler=\"cancelUpdateStatus()\" :isVisiable=\"showComfirm\" :msg=\"currentItem.status === 1 ? '确定下架该商品吗？' : '确定上架该商品吗？'\" />\n  </div>\n</template>\n\n<script>\n// @ is an alias to /src\nimport UploadImage from '../components/UploadImage'\nimport Comfirm from '@/components/Comfirm'\nimport qs from 'qs'\nexport default {\n  components: {\n    UploadImage,\n    Comfirm\n  },\n  data () {\n    return {\n      headers: [\n        { text: '商品ID', value: 'id', sortable: false },\n        { text: '商品名称', value: 'name', sortable: false },\n        { text: '原价', value: 'original', sortable: false },\n        { text: '现价', value: 'current', sortable: false },\n        { text: '库存', value: 'total', sortable: false },\n        { text: '商户', value: 'id', sortable: false },\n        { text: '地区', value: 'address', sortable: false },\n        { text: '状态', value: 'status', sortable: false },\n        { text: '详情', value: 'id', sortable: false }\n      ],\n      isPending: false,\n      desserts: [],\n      total: 0,\n      page: 1,\n      pageSize: 10,\n      currentItem: {}, // 当前操作 table item\n      showComfirm: false,\n      selectItems: [{\n        value: 10,\n        text: '10条/页'\n      }, {\n        value: 20,\n        text: '20条/页'\n      }, {\n        value: 50,\n        text: '50条/页'\n      }],\n      isShowDialog: false, // 新增弹框\n      isReadOnly: false,\n      isUpdate: false,\n      valid: false,\n      startDatemenu: false,\n      endDatemenu: false,\n      startTimeMenu: false,\n      endTimeMenu: false,\n      goodsInfo: {\n        name: '',\n        images: [],\n        intro: '',\n        details: [],\n        notice: '',\n        start_date: '',\n        end_date: '',\n        startTime: null,\n        endTime: null,\n        exchange: [],\n        userid: ''\n      },\n      stores: [], // 适用门店\n      formRulse: {\n        nameRules: [\n          v => !!v || '商品名称不能为空',\n          v => (v && v.length <= 100) || '100字以内'\n        ],\n        introRules: [\n          v => (v && v.length <= 1000) || '1000字以内'\n        ],\n        originalRules: [\n          v => !!v || '原价不能为空',\n          v => /^\\d+(\\.\\d{1,2})?$/.test(v) || '原价格式不正确'\n        ],\n        currentRules: [\n          v => !!v || '现价不能为空',\n          v => /^\\d+(\\.\\d{1,2})?$/.test(v) || '现价格式不正确'\n        ],\n        totalRules: [\n          v => !!v || '库存不能为空',\n          v => /^[1-9]\\d*$/.test(v) || '库存必须为数值'\n        ],\n        dateRules: [\n          v => !!v || '有效期不能为空'\n        ],\n        useridRules: [\n          v => !!v || '关联商户id不能为空'\n        ],\n        srcRules: [\n          v => (!v || v.length <= 10) || '10字以内'\n        ],\n        storesRules: [\n          v => (Array.isArray(v) && v.length > 0) || '兑换门店不能为空'\n        ],\n        noticeRules: [\n          v => (v && v.length <= 400) || '400字以内'\n        ]\n      },\n      currencyErrorMessages: '',\n      useridErrorMessages: ''\n    }\n  },\n  computed: {\n    current_format: {\n      get: function () {\n        return this.goodsInfo.current / 100 || ''\n      },\n      set: function (value) {\n        this.goodsInfo.current = value * 100 || ''\n      }\n    },\n    original_format: {\n      get: function () {\n        return this.goodsInfo.original / 100 || ''\n      },\n      set: function (value) {\n        this.goodsInfo.original = value * 100 || ''\n      }\n    }\n  },\n  created () {\n    this.fetchData()\n  },\n  methods: {\n    verifyCurrency() {\n      if (!this.goodsInfo.current || !this.goodsInfo.original) {\n        return\n      }\n      if (this.goodsInfo.original < this.goodsInfo.current) {\n        this.currencyErrorMessages = '原价不能小于现价'\n      } else {\n        this.currencyErrorMessages = ''\n      }\n    },\n    fetchData () {\n      this.isPending = true\n      this.$http({\n        url: '/travel/goods/info',\n        method: 'GET',\n        params: {\n          type: 1,\n          pageSize: this.pageSize,\n          page: this.page - 1 // 接口 第一页 page = 0\n        }\n      }).then(response => {\n        this.isPending = false\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.desserts = res.data.list\n          this.total = res.data.total\n        } else {\n          this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: res.respmsg,\n            alertType: 'error'\n          })\n        }\n      })\n    },\n    fetchStores (id, resetSelected) {\n      if (resetSelected && Number(id) === this.goodsInfo.userid) {\n        return\n      }\n      this.$http({\n        url: '/travel/goods/options',\n        method: 'POST',\n        data: qs.stringify({\n          id,\n          mode: 'shop_info'\n        })\n      }).then(response => {\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.useridErrorMessages = ''\n          if (resetSelected) {\n            this.stores = []\n            this.goodsInfo.exchange = []\n          }\n          res.data.map((item) => {\n            this.stores.push({\n              id: item.id,\n              name: item.name\n            })\n          })\n        } else if (res.respcd === '2102') {\n          this.useridErrorMessages = '该商户不存在，请检查商户id是否正确'\n        } else if (res.respcd === '2101') {\n          this.useridErrorMessages = '该商户下没有门店，请先添加门店'\n        }\n      })\n    },\n    addButton () {\n      this.reset()\n      this.isReadOnly = false\n      this.isShowDialog = true\n      this.isUpdate = false\n    },\n    goGoodsDetail (id, name) {\n      window.sessionStorage.setItem('goodsName', name)\n      this.$router.push({\n        name: 'store',\n        params: {\n          goodsId: id\n        }\n      })\n    },\n    viewGoods (info) {\n      this.isReadOnly = true\n      this.isShowDialog = true\n      this.isUpdate = true\n      this.goodsInfo = { ...info }\n      this.goodsInfo.start_date = info.start_date.substr(0, 10)\n      this.goodsInfo.end_date = info.end_date.substr(0, 10)\n      if (info.cut_expire) {\n        this.goodsInfo.startTime = info.cut_expire[0].start_time\n        this.goodsInfo.endTime = info.cut_expire[0].end_time\n      }\n      delete this.goodsInfo['cut_expire']\n      this.$refs.uploadimage.previewImages = [...info.images]\n      this.$refs.uploadetail.previewImages = [...info.details]\n      this.fetchStores(info.userid, false)\n    },\n    submit () {\n      if (!this.$refs.form.validate()) {\n        return\n      }\n      let images = this.$refs.uploadimage.previewImages\n      let details = this.$refs.uploadetail.previewImages\n      if (images.length === 0) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请上传商品图片',\n          alertType: 'warning'\n        })\n        return false\n      }\n      if (details.length === 0) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请上传商品详情图',\n          alertType: 'warning'\n        })\n        return false\n      }\n      let startTime = this.goodsInfo.startTime\n      let endTime = this.goodsInfo.endTime\n      if ((!!startTime && !endTime) || (!startTime && !!endTime)) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请填写完整使用时间段',\n          alertType: 'warning'\n        })\n        return false\n      }\n      let params = { ...this.goodsInfo }\n      params.images = JSON.stringify(images)\n      params.details = JSON.stringify(details)\n      params.exchange = JSON.stringify(params.exchange)\n      if (params.start_date.length === 10) {\n        params.start_date += ' 00:00:00'\n      }\n      if (params.end_date.length === 10) {\n        params.end_date += ' 23:59:59'\n      }\n      params.cut_expire = JSON.stringify(new Array({\n        start_time: params.startTime,\n        end_time: params.endTime\n      }))\n      delete params['startTime']\n      delete params['endTime']\n      let mode = this.isUpdate ? 'change_info' : 'add_info'\n      params.mode = mode\n      params.type = 1\n      this.$http({\n        url: '/travel/goods/options',\n        method: 'POST',\n        data: qs.stringify(params)\n      }).then(response => {\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: this.isUpdate ? '修改商品成功' : '新增商品成功',\n            alertType: 'success'\n          })\n          this.isShowDialog = false\n          this.fetchData()\n        } else {\n          this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: res.respmsg,\n            alertType: 'error'\n          })\n        }\n      })\n    },\n    beforeUpdateStatus (value, id) {\n      let status = value === 1 ? 0 : 1\n      this.showComfirm = true\n      this.currentItem = {\n        status,\n        id\n      }\n    },\n    cancelUpdateStatus () {\n      this.showComfirm = false\n      this.desserts.map((item) => {\n        if (item.id === this.currentItem.id) {\n          item.status = this.currentItem.status\n        }\n      })\n    },\n    updateStatus () {\n      let status = this.currentItem.status === 1 ? 0 : 1\n      this.$http({\n        url: '/travel/goods/options',\n        method: 'POST',\n        data: qs.stringify({\n          id: this.currentItem.id,\n          mode: 'change_info',\n          status\n        })\n      }).then(response => {\n        let res = response.data\n        if (res.respcd === '0000') {\n          this.showComfirm = false\n          this.$store.dispatch('setAlert', {\n            alert: true,\n            alertContent: status === 1 ? '上架商品成功' : '下架商品成功',\n            alertType: 'success',\n            alertColor: status === 1 ? 'primary' : 'rgba(0,0,0,.38)'\n          })\n        }\n      })\n    },\n    reset () {\n      this.$refs.form.reset()\n      this.useridErrorMessages = ''\n      this.currencyErrorMessages = ''\n      this.$refs.uploadimage.previewImages = []\n      this.$refs.uploadetail.previewImages = []\n    }\n  }\n}\n</script>\n"],"sourceRoot":"src/pages/welfare/views"}]}