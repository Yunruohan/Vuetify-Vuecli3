{"remainingRequest":"/Users/dmsun/Desktop/workspace/solar/node_modules/babel-loader/lib/index.js!/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/common/CouponAdd.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/dmsun/Desktop/workspace/solar/src/pages/welfare/views/common/CouponAdd.vue","mtime":1547889925000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/cache-loader/dist/cjs.js","mtime":1547890140000},{"path":"/Users/dmsun/Desktop/workspace/solar/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"/Users/dmsun/Desktop/workspace/solar/node_modules/@babel/runtime/regenerator\";\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } } function _next(value) { step(\"next\", value); } function _throw(err) { step(\"throw\", err); } _next(); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UploadImage from '../../components/UploadImage';\nimport Http from '@/http';\nexport default {\n  props: ['item'],\n  data: function data() {\n    return {\n      dialog: false,\n      valid: true,\n      name: '',\n      nameRules: [function (v) {\n        return !!v || '请填写名称';\n      }, function (v) {\n        return v && v.length <= 40 || '最多40个字';\n      }],\n      introRules: [function (v) {\n        return v && v.length <= 400 || '最多400个字';\n      }],\n      term: '',\n      termRules: [function (v) {\n        return !!v || '请填写使用条件';\n      }, function (v) {\n        return v && v.length <= 40 || '最多40个字';\n      }],\n      intro: '',\n      total: '',\n      totalRules: [function (v) {\n        return !!v && v > 0 || '请填写库存';\n      }, function (v) {\n        return /^[0-9]*$/.test(v) || '请填写数字';\n      }],\n      userid: '',\n      useridRules: [function (v) {\n        return !!v || '请填写关联商户id';\n      }],\n      imgs1: [],\n      imgs2: [],\n      dates: [],\n      menu: false,\n      menu1: false,\n      time1: null,\n      time2: null,\n      menu2: false,\n      menu3: false,\n      menu4: false,\n      isLoading: false,\n      model: null,\n      search: null,\n      exchange: [],\n      timer: null,\n      date1: '',\n      date2: '',\n      storeData: [],\n      submitLoading: false\n    };\n  },\n  computed: {\n    computedDateFormatted: {\n      get: function get() {\n        return this.formatDate(this.date2);\n      },\n      set: function set() {\n        return this.formatDate(this.date2);\n      }\n    },\n    dateFormatted: {\n      get: function get() {\n        return this.formatDate(this.date1);\n      },\n      set: function set() {\n        return this.formatDate(this.date1);\n      }\n    }\n  },\n  methods: {\n    formatDate: function formatDate(date) {\n      if (!date) return null;\n\n      var _date$split = date.split('-'),\n          _date$split2 = _slicedToArray(_date$split, 3),\n          year = _date$split2[0],\n          month = _date$split2[1],\n          day = _date$split2[2];\n\n      return \"\".concat(year, \"-\").concat(month, \"-\").concat(day);\n    },\n    parseDate: function parseDate(date) {\n      if (!date) return null;\n\n      var _date$split3 = date.split('/'),\n          _date$split4 = _slicedToArray(_date$split3, 3),\n          month = _date$split4[0],\n          day = _date$split4[1],\n          year = _date$split4[2];\n\n      return \"\".concat(year, \"-\").concat(month.padStart(2, '0'), \"-\").concat(day.padStart(2, '0'));\n    },\n    chipCtrl: function chipCtrl(item) {\n      var index = this.model.indexOf(item);\n      this.model.splice(index, 1);\n    },\n    modelClean: function modelClean() {\n      this.model = '';\n    },\n    useridInput: function () {\n      var _useridInput = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var res, data, exchange;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return Http.post('/travel/goods/options', {\n                  id: this.userid,\n                  mode: 'shop_info'\n                });\n\n              case 2:\n                res = _context.sent;\n\n                if (res && res.data) {\n                  if (res.data.respcd === '0000') {\n                    data = _toConsumableArray(res.data.data);\n                    exchange = [];\n                    data.map(function (item) {\n                      exchange.push({\n                        name: item.name,\n                        id: item.id\n                      });\n                    });\n                    this.storeData = _toConsumableArray(data);\n                    this.exchange = exchange.concat();\n                  }\n                }\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function useridInput() {\n        return _useridInput.apply(this, arguments);\n      };\n    }(),\n    submit: function () {\n      var _submit = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var image, arr, obj, details, param, res;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                image = this.$refs.uploadimage1.previewImages[0];\n\n                if (image) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                this.$store.dispatch('setAlert', {\n                  alert: true,\n                  alertContent: '请上传首页图片',\n                  alertType: 'warning'\n                });\n                return _context2.abrupt(\"return\");\n\n              case 4:\n                if (this.date1) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                this.$store.dispatch('setAlert', {\n                  alert: true,\n                  alertContent: '请选择开始日期',\n                  alertType: 'warning'\n                });\n                return _context2.abrupt(\"return\");\n\n              case 7:\n                if (this.date2) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                this.$store.dispatch('setAlert', {\n                  alert: true,\n                  alertContent: '请选择结束日期',\n                  alertType: 'warning'\n                });\n                return _context2.abrupt(\"return\");\n\n              case 10:\n                arr = [];\n                obj = {};\n                obj.start_time = this.time1;\n                obj.end_time = this.time2;\n                arr.push(obj);\n\n                if (!((this.time1 || this.time2) && (!this.time1 || !this.time2))) {\n                  _context2.next = 18;\n                  break;\n                }\n\n                this.$store.dispatch('setAlert', {\n                  alert: true,\n                  alertContent: '请填写完整使用时间段',\n                  alertType: 'warning'\n                });\n                return _context2.abrupt(\"return\");\n\n              case 18:\n                if (this.model.length) {\n                  _context2.next = 21;\n                  break;\n                }\n\n                this.$store.dispatch('setAlert', {\n                  alert: true,\n                  alertContent: '门店不能为空',\n                  alertType: 'warning'\n                });\n                return _context2.abrupt(\"return\");\n\n              case 21:\n                details = this.$refs.uploadimage2.previewImages[0];\n                param = {\n                  images: JSON.stringify([image]),\n                  details: JSON.stringify([details]),\n                  name: this.name,\n                  term: this.term,\n                  intro: this.intro,\n                  total: this.total,\n                  userid: this.userid,\n                  type: 2,\n                  start_date: this.date1,\n                  end_date: \"\".concat(this.date2, \" 23:59:59\"),\n                  cut_expire: JSON.stringify(arr),\n                  exchange: JSON.stringify(this.model)\n                };\n\n                if (!this.$refs.form.validate()) {\n                  _context2.next = 39;\n                  break;\n                }\n\n                this.submitLoading = true;\n\n                if (!(this.item && this.item.id)) {\n                  _context2.next = 33;\n                  break;\n                }\n\n                param.id = this.item.id;\n                param.mode = 'change_info';\n                _context2.next = 30;\n                return Http.post('/travel/goods/options', param);\n\n              case 30:\n                res = _context2.sent;\n                _context2.next = 37;\n                break;\n\n              case 33:\n                param.mode = 'add_info';\n                _context2.next = 36;\n                return Http.post('/travel/goods/options', param);\n\n              case 36:\n                res = _context2.sent;\n\n              case 37:\n                this.submitLoading = false;\n\n                if (res && res.data) {\n                  if (res.data.respcd === '0000') {\n                    this.$emit('ctrl');\n                    this.cancel();\n                    this.$store.dispatch('setAlert', {\n                      alert: true,\n                      alertContent: '操作成功',\n                      alertType: 'success'\n                    });\n                  } else {\n                    // 问题提示\n                    this.$store.dispatch('setAlert', {\n                      alert: true,\n                      alertContent: res.data.respmsg,\n                      alertType: 'error'\n                    });\n                  }\n                }\n\n              case 39:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function submit() {\n        return _submit.apply(this, arguments);\n      };\n    }(),\n    cancel: function cancel() {\n      this.dialog = false;\n      this.$refs.form.reset();\n      this.$refs.uploadimage1.previewImages = [];\n      this.$refs.uploadimage1.showAddBtn = true;\n      this.$refs.uploadimage2.previewImages = [];\n      this.$refs.uploadimage2.showAddBtn = true;\n    }\n  },\n  watch: {\n    'dialog': function dialog(val) {\n      if (val && this.item) {\n        this.name = this.item.name;\n        this.term = this.item.term;\n        this.intro = this.item.intro;\n        this.total = this.item.total;\n        this.date1 = this.item.start_date;\n        this.date2 = this.item.end_date;\n        this.time1 = this.item['cut_expire'][0]['start_time'];\n        this.time2 = this.item['cut_expire'][0]['end_time'];\n        this.userid = this.item.userid;\n        this.model = _toConsumableArray(this.item.exchange);\n        this.exchange = _toConsumableArray(this.model);\n        this.$refs.uploadimage1.previewImages.splice(0, 1, this.item.images);\n        this.$refs.uploadimage2.previewImages.splice(0, 1, this.item.details);\n        this.$refs.uploadimage1.showAddBtn = false;\n        this.$refs.uploadimage2.showAddBtn = false;\n      }\n\n      if (!val) {\n        this.cancel();\n      }\n    }\n  },\n  components: {\n    UploadImage: UploadImage\n  }\n};",{"version":3,"sources":["CouponAdd.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-layout row justify-end>\n    <v-dialog v-model=\"dialog\" fullscreen hide-overlay transition=\"dialog-bottom-transition\">\n      <v-btn slot=\"activator\" color=\"primary\" v-if=\"item\">\n        编辑\n      </v-btn>\n      <v-btn slot=\"activator\" color=\"primary\" dark v-else>新增优惠券</v-btn>\n      <v-toolbar dark color=\"primary\" class=\"cus-toolbar\">\n        <v-toolbar-title align-self-center v-if=\"item\">编辑优惠券</v-toolbar-title>\n        <v-toolbar-title align-self-center v-else>新增优惠券</v-toolbar-title>\n        <v-btn icon dark @click.native=\"dialog = false\">\n          <v-icon>close</v-icon>\n        </v-btn>\n      </v-toolbar>\n      <v-form ref=\"form\" v-model=\"valid\" lazy-validation class=\"banner-form\">\n        <v-text-field\n          v-model=\"name\"\n          :rules=\"nameRules\"\n          :counter=\"40\"\n          label=\"名称\"\n          required\n        ></v-text-field>\n        <v-layout row align-end>\n          <uploadImage ref=\"uploadimage1\" :maxNumber='1' class=\"mr-2\" label=\"首页图片\"/>\n          <p class=\"ma-0 pa-0 line-h-50\"><span>*&nbsp;</span>jpg格式，1张，不超过200k，推荐尺寸</p>\n        </v-layout>\n        <v-text-field\n          v-model=\"term\"\n          :rules=\"termRules\"\n          :counter=\"40\"\n          label=\"使用条件\"\n          required\n        ></v-text-field>\n        <v-textarea\n          v-model=\"intro\"\n          :rules=\"introRules\"\n          label=\"描述\"\n          counter=\"400\"\n        ></v-textarea>\n        <v-layout row align-end>\n          <uploadImage ref=\"uploadimage2\" :maxNumber='1' class=\"mr-2\" label=\"详情图片\"/>\n          <p class=\"ma-0 pa-0 line-h-50\"><span>*&nbsp;</span>jpg格式，1张，不超过200k，推荐尺寸</p>\n        </v-layout>\n        <v-text-field\n          v-model=\"total\"\n          :rules=\"totalRules\"\n          label=\"库存\"\n          required\n        ></v-text-field>\n        <v-layout row flex-end>\n          <!-- 日期 -->\n          <v-layout row wrap class=\"v-btn-cus\" justify-space-between>\n            <v-flex xs11 sm5>\n        <v-menu\n          ref=\"menu1\"\n          :close-on-content-click=\"false\"\n          v-model=\"menu1\"\n          :nudge-right=\"40\"\n          lazy\n          transition=\"scale-transition\"\n          offset-y\n          full-width\n          max-width=\"290px\"\n          min-width=\"290px\"\n        >\n          <v-text-field\n            slot=\"activator\"\n            v-model=\"dateFormatted\"\n            label=\"开始日期\"\n            persistent-hint\n            prepend-icon=\"event\"\n            @blur=\"date1 = parseDate(dateFormatted)\"\n          ></v-text-field>\n          <v-date-picker :max=\"date2\" v-model=\"date1\" no-title @input=\"menu1 = false\"></v-date-picker>\n        </v-menu>\n      </v-flex>\n\n      <v-flex xs11 sm5>\n        <v-menu\n          :close-on-content-click=\"false\"\n          v-model=\"menu2\"\n          :nudge-right=\"40\"\n          lazy\n          transition=\"scale-transition\"\n          offset-y\n          full-width\n          max-width=\"290px\"\n          min-width=\"290px\"\n        >\n          <v-text-field\n            slot=\"activator\"\n            v-model=\"computedDateFormatted\"\n            label=\"结束日期\"\n            persistent-hint\n            prepend-icon=\"event\"\n            @blur=\"date2 = parseDate(computedDateFormatted)\"\n          ></v-text-field>\n          <v-date-picker :min=\"date1\" v-model=\"date2\" no-title @input=\"menu2 = false\"></v-date-picker>\n        </v-menu>\n      </v-flex>\n          </v-layout>\n        </v-layout>\n        <v-layout row flex-end>\n          <!-- 时间 -->\n          <v-layout row wrap class=\"v-btn-cus\" justify-space-between>\n            <v-flex xs11 sm5>\n              <v-menu\n                ref=\"menu3\"\n                :close-on-content-click=\"false\"\n                v-model=\"menu3\"\n                :nudge-right=\"40\"\n                :return-value.sync=\"time1\"\n                lazy\n                transition=\"scale-transition\"\n                offset-y\n                full-width\n                min-width=\"290px\"\n              >\n                <v-text-field\n                  slot=\"activator\"\n                  v-model=\"time1\"\n                  label=\"开始时间\"\n                  prepend-icon=\"access_time\"\n                  readonly\n                ></v-text-field>\n                <v-time-picker\n                  format=\"24hr\"\n                  v-if=\"menu3\"\n                  v-model=\"time1\"\n                  full-width\n                  :max=\"time2\"\n                  @change=\"$refs.menu3.save(time1)\"\n                ></v-time-picker>\n              </v-menu>\n            </v-flex>\n            <v-flex xs11 sm5>\n              <v-menu\n                ref=\"menu4\"\n                :close-on-content-click=\"false\"\n                v-model=\"menu4\"\n                :nudge-right=\"40\"\n                :return-value.sync=\"time2\"\n                lazy\n                transition=\"scale-transition\"\n                offset-y\n                full-width\n                min-width=\"290px\"\n              >\n                <v-text-field\n                  slot=\"activator\"\n                  v-model=\"time2\"\n                  label=\"结束时间\"\n                  prepend-icon=\"access_time\"\n                  readonly\n                ></v-text-field>\n                <v-time-picker\n                  format=\"24hr\"\n                  v-if=\"menu4\"\n                  v-model=\"time2\"\n                  full-width\n                  :min=\"time1\"\n                  @change=\"$refs.menu4.save(time2)\"\n                ></v-time-picker>\n              </v-menu>\n            </v-flex>\n          </v-layout>\n        </v-layout>\n        <v-text-field\n          v-model=\"userid\"\n          :rules=\"useridRules\"\n          label=\"关联商户id\"\n          required\n          @blur=\"useridInput()()\"\n          @change=\"modelClean\"\n        ></v-text-field>\n        <v-layout row align-end>\n          <v-select\n            v-model=\"model\"\n            :items=\"exchange\"\n            item-text=\"name\"\n            item-value=\"id\"\n            chips\n            no-data-text=\"暂无数据\"\n            placeholder=\"请选择门店\"\n            label=\"选择门店\"\n            return-object\n            multiple\n          ></v-select>\n        </v-layout>\n        <v-layout row wrap>\n          <v-flex v-for=\"(_item, _index) in model\" :key=\"_index\">\n            <div class=\"chip-like-div\">\n              <span>{{_item.name}}</span>\n              <v-icon color=\"white\" @click=\"chipCtrl(_item)\" small class=\"chip-like-icon\">close</v-icon>\n            </div>\n          </v-flex>\n        </v-layout>\n        <v-btn\n          :disabled=\"!valid\"\n          @click=\"submit\"\n          color=\"primary\"\n          :loading=\"submitLoading\"\n        >\n          保存\n        </v-btn>\n        <v-btn @click=\"cancel\">取消</v-btn>\n      </v-form>\n    </v-dialog>\n  </v-layout>\n</template>\n<script>\nimport UploadImage from '../../components/UploadImage'\nimport Http from '@/http'\nexport default {\n  props: [\n    'item'\n  ],\n  data () {\n    return {\n      dialog: false,\n      valid: true,\n      name: '',\n      nameRules: [\n        v => !!v || '请填写名称',\n        v => (v && v.length <= 40) || '最多40个字'\n      ],\n      introRules: [\n        v => (v && v.length <= 400) || '最多400个字'\n      ],\n      term: '',\n      termRules: [\n        v => !!v || '请填写使用条件',\n        v => (v && v.length <= 40) || '最多40个字'\n      ],\n      intro: '',\n      total: '',\n      totalRules: [\n        v => (!!v && (v > 0)) || '请填写库存',\n        v => /^[0-9]*$/.test(v) || '请填写数字'\n      ],\n      userid: '',\n      useridRules: [\n        v => !!v || '请填写关联商户id'\n      ],\n      imgs1: [],\n      imgs2: [],\n      dates: [],\n      menu: false,\n      menu1: false,\n      time1: null,\n      time2: null,\n      menu2: false,\n      menu3: false,\n      menu4: false,\n      isLoading: false,\n      model: null,\n      search: null,\n      exchange: [],\n      timer: null,\n      date1: '',\n      date2: '',\n      storeData: [],\n      submitLoading: false\n    }\n  },\n  computed: {\n    computedDateFormatted: {\n      get () {\n        return this.formatDate(this.date2)\n      },\n      set () {\n        return this.formatDate(this.date2)\n      }\n    },\n    dateFormatted: {\n      get () {\n        return this.formatDate(this.date1)\n      },\n      set () {\n        return this.formatDate(this.date1)\n      }\n    }\n  },\n  methods: {\n    formatDate (date) {\n      if (!date) return null\n      const [year, month, day] = date.split('-')\n      return `${year}-${month}-${day}`\n    },\n    parseDate (date) {\n      if (!date) return null\n      const [month, day, year] = date.split('/')\n      return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`\n    },\n    chipCtrl (item) {\n      let index = this.model.indexOf(item)\n      this.model.splice(index, 1)\n    },\n    modelClean () {\n      this.model = ''\n    },\n    async useridInput () {\n      let res = await Http.post('/travel/goods/options', {\n        id: this.userid,\n        mode: 'shop_info'\n      })\n      if (res && res.data) {\n        if (res.data.respcd === '0000') {\n          let data = [...res.data.data]\n          let exchange = []\n          data.map(item => {\n            exchange.push({\n              name: item.name,\n              id: item.id\n            })\n          })\n          this.storeData = [...data]\n          this.exchange = [...exchange]\n        }\n      }\n    },\n    async submit () {\n      let image = this.$refs.uploadimage1.previewImages[0]\n      if (!image) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请上传首页图片',\n          alertType: 'warning'\n        })\n        return\n      }\n      if (!this.date1) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请选择开始日期',\n          alertType: 'warning'\n        })\n        return\n      }\n      if (!this.date2) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请选择结束日期',\n          alertType: 'warning'\n        })\n        return\n      }\n      let arr = []\n      let obj = {}\n      obj.start_time = this.time1\n      obj.end_time = this.time2\n      arr.push(obj)\n      if ((this.time1 || this.time2) && (!this.time1 || !this.time2)) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '请填写完整使用时间段',\n          alertType: 'warning'\n        })\n        return\n      }\n      if (!this.model.length) {\n        this.$store.dispatch('setAlert', {\n          alert: true,\n          alertContent: '门店不能为空',\n          alertType: 'warning'\n        })\n        return\n      }\n      let details = this.$refs.uploadimage2.previewImages[0]\n      let param = {\n        images: JSON.stringify([image]),\n        details: JSON.stringify([details]),\n        name: this.name,\n        term: this.term,\n        intro: this.intro,\n        total: this.total,\n        userid: this.userid,\n        type: 2,\n        start_date: this.date1,\n        end_date: `${this.date2} 23:59:59`,\n        cut_expire: JSON.stringify(arr),\n        exchange: JSON.stringify(this.model)\n      }\n      let res\n      if (this.$refs.form.validate()) {\n        this.submitLoading = true\n        if (this.item && this.item.id) {\n          param.id = this.item.id\n          param.mode = 'change_info'\n          res = await Http.post('/travel/goods/options', param)\n        } else {\n          param.mode = 'add_info'\n          res = await Http.post('/travel/goods/options', param)\n        }\n        this.submitLoading = false\n        if (res && res.data) {\n          if (res.data.respcd === '0000') {\n            this.$emit('ctrl')\n            this.cancel()\n            this.$store.dispatch('setAlert', {\n              alert: true,\n              alertContent: '操作成功',\n              alertType: 'success'\n            })\n          } else {\n            // 问题提示\n            this.$store.dispatch('setAlert', {\n              alert: true,\n              alertContent: res.data.respmsg,\n              alertType: 'error'\n            })\n          }\n        }\n      }\n    },\n    cancel () {\n      this.dialog = false\n      this.$refs.form.reset()\n      this.$refs.uploadimage1.previewImages = []\n      this.$refs.uploadimage1.showAddBtn = true\n      this.$refs.uploadimage2.previewImages = []\n      this.$refs.uploadimage2.showAddBtn = true\n    }\n  },\n  watch: {\n    'dialog': function (val) {\n      if (val && this.item) {\n        this.name = this.item.name\n        this.term = this.item.term\n        this.intro = this.item.intro\n        this.total = this.item.total\n        this.date1 = this.item.start_date\n        this.date2 = this.item.end_date\n        this.time1 = this.item['cut_expire'][0]['start_time']\n        this.time2 = this.item['cut_expire'][0]['end_time']\n        this.userid = this.item.userid\n        this.model = [...this.item.exchange]\n        this.exchange = [...this.model]\n        this.$refs.uploadimage1.previewImages.splice(0, 1, this.item.images)\n        this.$refs.uploadimage2.previewImages.splice(0, 1, this.item.details)\n        this.$refs.uploadimage1.showAddBtn = false\n        this.$refs.uploadimage2.showAddBtn = false\n      }\n      if (!val) {\n        this.cancel()\n      }\n    }\n  },\n  components: {\n    UploadImage\n  }\n}\n</script>\n<style scoped>\n.line-h-50{line-height: 50px;}\n.text-field-cus{margin: 0 10px 0 50px;padding: 0;width: 300px;flex-grow: 0;flex-shrink: 0;}\n.layout-row-cus{width: 50%;margin: 0 auto;flex-grow: 0;}\n.banner-form{margin: 0 auto;}\n.chip-like-div{\n  padding: 5px 10px;\n  border: 1px solid;\n  background: #4caf50 ;\n  display: inline-block;\n  border-radius: 5px;\n  color: white;\n}\n.chip-like-icon{\n  margin-left: 5px;\n}\n</style>\n"],"sourceRoot":"src/pages/welfare/views/common"}]}